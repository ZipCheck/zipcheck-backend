<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ssafy.zipcheck.sticker.mapper.StickerMapper">

    <insert id="insertSticker" parameterType="com.ssafy.zipcheck.sticker.vo.Sticker">
        INSERT INTO sticker (user_id, deal_id, sticker_type_id, description)
        VALUES (#{userId}, #{dealId}, #{stickerTypeId}, #{description})
    </insert>

    <select id="findStickerById" parameterType="long" resultType="com.ssafy.zipcheck.sticker.vo.Sticker">
        SELECT sticker_id, user_id, deal_id, sticker_type_id, description, created_at
        FROM sticker
        WHERE sticker_id = #{stickerId}
    </select>

    <select id="findStickersByDealId" parameterType="long" resultType="com.ssafy.zipcheck.sticker.dto.StickerResponse">
        SELECT
            s.sticker_id AS stickerId,
            s.user_id AS userId,
            u.nickname AS userNickname,
            s.deal_id AS dealId,
            s.sticker_type_id AS stickerTypeId,
            st.name AS stickerTypeName,
            st.icon_url AS stickerIconUrl,
            s.description,
            s.created_at AS createdAt
        FROM
            sticker s
        JOIN
            users u ON s.user_id = u.user_id
        JOIN
            sticker_type st ON s.sticker_type_id = st.sticker_type_id
        WHERE
            s.deal_id = #{dealId}
        ORDER BY
            s.created_at DESC
    </select>

    <delete id="deleteSticker" parameterType="long">
        DELETE FROM sticker WHERE sticker_id = #{stickerId}
    </delete>

    <select id="findUserIdByStickerId" parameterType="long" resultType="java.lang.Integer">
        SELECT user_id
        FROM sticker
        WHERE sticker_id = #{stickerId}
    </select>

</mapper>