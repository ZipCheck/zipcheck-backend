<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ssafy.zipcheck.comments.mapper.CommentMapper">

    <resultMap id="CommentMap" type="com.ssafy.zipcheck.comments.vo.Comments">
        <id property="commentId" column="comment_id"/>
        <result property="content" column="content"/>
        <result property="createdAt" column="created_at"/>
        <result property="boardId" column="boards_board_id"/>
        <result property="userId" column="users_user_id"/>
        <result property="visible" column="visible"/>
    </resultMap>

    <!-- 댓글 목록 조회 -->
    <select id="findByBoardId" resultMap="CommentMap">
        SELECT *
        FROM comments
        WHERE boards_board_id = #{boardId}
          AND visible = 1
        ORDER BY created_at ASC
    </select>

    <!-- 댓글 등록 -->
    <insert id="insert" useGeneratedKeys="true" keyProperty="commentId">
        INSERT INTO comments (content, created_at, boards_board_id, users_user_id, visible)
        VALUES (#{content}, NOW(), #{boardId}, #{userId}, 1)
    </insert>

    <!-- 댓글 삭제 (soft delete) -->
    <update id="delete">
        UPDATE comments
        SET visible = 0
        WHERE comment_id = #{commentId}
    </update>

</mapper>
